apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "ceaser-ad-business.fullname" . }}-test"
  labels:
    {{- include "ceaser-ad-business.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-weight": "1"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  restartPolicy: Never
  containers:
    - name: wget
      image: busybox:1.35
      command: ['wget']
      args: ['{{ include "ceaser-ad-business.fullname" . }}-frontend:{{ .Values.frontend.service.port }}']
    - name: grpc-health-check
      image: grpc/grpc-health-probe:v0.4.15
      command:
        - /bin/grpc_health_probe
        - -addr={{ include "ceaser-ad-business.fullname" . }}-python-ai-engine:{{ .Values.pythonAiEngine.service.port }}
    - name: api-health-check
      image: curlimages/curl:8.4.0
      command:
        - curl
        - -f
        - http://{{ include "ceaser-ad-business.fullname" . }}-go-api-gateway:{{ .Values.goApiGateway.service.port }}/health
